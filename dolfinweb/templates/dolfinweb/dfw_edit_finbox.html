{% extends "dfwbase.html" %}
{% block content %}
{% load django_bootstrap5 %}
<h4 class="bd-title p-2 bg-secondary text-light">Image View</h4>
<table class="table table-striped table-sm">
    <tbody>
    <tr><th>파일이름</th><td>{{ image.filename|default_if_none:''}}</td></tr>
    <tr><th>촬영일시</th><td>{{ image.exifdatetime|default_if_none:''}}</td></tr>
    <tr><th>폴더이름</th><td>{{ image.dirname|default_if_none:''}}</td></tr>
    <tr>
        <td colspan="2"><div class="text-center">
            <canvas id="canvas" width="1024" height="600"></canvas>
            <div id="fin_list" class="container">
            </div>
        </div>
        <form action="" method="post">
            {% csrf_token %}
            <table class="table table-striped mt-3" style="display:none;">
                <thead class="text-center"><tr><th>이름</th><th>Box좌표</th><th>삭제</th></tr></thead>
                {% if dolfinbox_formset %}
                    {{ dolfinbox_formset.management_form }}
                    <tbody id="dolfinbox-form-container">
                        <tr id="empty-form" style="display:none;">
                            <td>{{dolfinbox_formset.empty_form.dolfin_image}}{{dolfinbox_formset.empty_form.boxname}}</td>
                            <td>{{dolfinbox_formset.empty_form.coords_str}}</td>
                            <td>{{dolfinbox_formset.empty_form.DELETE}}</td>
                        </tr>
                        {% for dolfinbox_form in dolfinbox_formset %}
                        <tr class="dolfinbox-form text-center">
                            <td>{{dolfinbox_form.id}}{{dolfinbox_form.dolfin_image}}{{dolfinbox_form.boxname}}</td>
                            <td>{{dolfinbox_form.coords_str}}</td>
                            <td>{{dolfinbox_form.DELETE}}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                {% endif %}
                <tfoot><tr><td colspan="6">
                    <div class="container text-center">
                    </div>
                </td></tr></tfoot>
            </table>
            {% bootstrap_button "Save" button_type="submit" button_class="btn-primary" %}
        </form>
        
        </td>
    </tr>
    </tbody>    
<tfoot><tr><td colspan="2"></td></tr></tfoot>
</table>
<script>
    {% include "dolfinweb/dfw_finbox.js" %}
    {% if image.finboxes.all %}
    box_list = [ 
    {%for finbox in image.finboxes.all %}
        [ {{finbox.coords_str}} ],
    {% endfor %} ]
    {% endif %}
    editable = true;
</script>
{% endblock %}

