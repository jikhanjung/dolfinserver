var BIRDNAME_LIST=[
	["가창오리", "Anas formosa"],
	["개리", "Anser cygnoides"],
	["검둥오리", "Melanitta nigra"],
	["흰죽지", "Aythya marila"],
	["고니", "Cygnus columbianus"],
	["고방오리", "Anas acuta"],
	["넓적부리", "Anas clypeata"],
	["죽지", "Aythya fuligula"],
	["미국쇠오리", "Anas crecca carolinensis"],
	["바다꿩", "Clangula hyemalis"],
	["비오리", "Mergus serrator"],
	["발구지", "Anas querquedula"],
	["북방흰뺨오리", "Bucephala islandica"],
	["붉은가슴흰죽지", "Aythya baeri"],
	["비오리", "Mergus merganser"],
	["쇠기러기", "Anser albifrons"],
	["쇠오리", "Anas crecca crecca"],
	["아메리카홍머리오리", "Anas americana"],
	["알락오리", "Anas strepera"],
	["원앙", "Aix galericulata"],
	["원앙사촌", "Tadorna cristata (1916년 최후 기록이)"],
	["청둥오리", "Anas platyrhynchos"],
	["청머리오리", "Anas falcata"],
	["큰고니", "Cygnus cygnus"],
	["큰기러기", "Anser fabalis"],
	["큰흰죽지", "Aythya valisineria"],
	["호사비오리", "Mergus squamatus"],
	["혹고니", "Cygnus olor"],
	["혹부리오리", "Tadorna tadorna"],
	["홍머리오리", "Anas penelope"],
	["황오리", "Tadorna ferruginea"],
	["회색기러기", "Anser anser"],
	["흑기러기", "Branta bernicla"],
	["흰기러기", "Anser caerulescens"],
	["흰비오리", "Mergus albellus (Mergellus?)"],
	["흰머리기러기", "Anser canagicus (canagica?)"],
	["흰뺨검둥오리", "Anas poecilorhyncha"],
	["흰뺨오리", "Bucephala clangula"],
	["흰이마기러기", "Anser erythropus"],
	["흰줄박이오리", "Histrionicus histrionicus"],
	["흰죽지", "Aythya ferina"],
	["미국오리", "Anas rubripes"],
	["미국흰죽지", "Aythya americana"],
	["붉은부리흰죽지 -Netta rufina"],
	["검은목논병아리", "Podiceps nigricollis"],
	["귀뿔논병아리", "Podiceps auritus"],
	["논병아리", "Tachybaptus ruficollis"],
	["뿔논병아리", "Podiceps cristatus"],
	["큰논병아리", "Podiceps grisegena"],
	["꿩", "Phasianus colchicus"],
	["들꿩", "Bonasa bonasia"],
	["메추라기", "Coturnix japonica"],
	["닭", "Tetrao tetrix"],
	["갈매기", "Larus canus"],
	["검은등제비갈매기", "Sterna fuscata"],
	["검은머리갈매기", "Larus saundersi"],
	["괭이갈매기", "Larus crassirostris"],
	["붉은부리갈매기", "Larus ridibundus"],
	["세가락갈매기", "Rissa tridactyla"],
	["쇠목테갈매기", "Rhodostethia rosea"],
	["쇠제비갈매기", "Sterna albifrons"],
	["수리갈매기", "Larus glaucescens"],
	["작은흰갈매기", "Larus glaucoides"],
	["재갈매기", "Larus argentatus"],
	["적호갈매기 / 고대갈매기", "Larus relictus"],
	["줄무늬노랑발갈매기", "Larus heuglini"],
	["카스피해갈매기", "Larus cachinnans"],
	["큰재갈매기", "Larus schistisagus"],
	["흰갈매기", "Larus hyperboreus"],
	["북극도둑갈매기 (Stercorarius parasiticus)"],
	["긴부리도요", "Limnodromus scolopaceus"],
	["깝작도요", "Actitis hypoleucos (Tringa?)"],
	["꺅도요", "Gallinago gallinago"],
	["꺅도요사촌", "Gallinago megala"],
	["꼬까도요", "Arenaria interpres"],
	["꼬마도요", "Lymnocryptes minimus (1916년 최후 기록이)"],
	["넓적부리도요", "Eurynorhynchus pygmeus"],
	["노랑발도요", "Tringa brevipes"],
	["누른도요", "Tryngites subruficollis"],
	["뒷부리도요", "Xenus cinereus (Tringa cinerea?)"],
	["마도요", "Numenius arquata"],
	["메추라기도요", "Calidris acuminata"],
	["멧도요", "Scolopax rusticola"],
	["목도리도요", "Philomachus pugnax"],
	["민물도요", "Calidris alpina"],
	["바늘꼬리도요", "Gallinago stenura"],
	["붉은가슴도요", "Calidris canutus"],
	["붉은갯도요", "Calidris ferruginea"],
	["붉은배지느러미발도요", "Phalaropus fulicarius (fulicaria?)"],
	["붉은발도요", "Tringa totanus"],
	["붉은어깨도요", "Calidris tenuirostris"],
	["삑삑도요", "Tringa ochropus"],
	["세가락도요", "Calidris alba"],
	["송곳부리도요", "Limicola falcinellus"],
	["쇠부리도요", "Numenius minutus"],
	["쇠청다리도요", "Tringa stagnatilis"],
	["아메리카메추라기도요", "Calidris melanotos"],
	["알락꼬리마도요", "Numenius madagascariensis"],
	["알락도요", "Tringa glareola"],
	["작은도요", "Calidris minuta"],
	["좀도요", "Calidris ruficollis"],
	["종달도요", "Calidris subminuta"],
	["중부리도요", "Numenius phaeopus"],
	["지느러미발도요", "Phalaropus lobatus"],
	["청다리도요", "Tringa nebularia"],
	["청다리도요사촌", "Tringa guttifer"],
	["청도요", "Gallinago solitaria"],
	["큰꺅도요", "Gallinago hardwickii"],
	["큰뒷부리도요", "Limosa lapponica"],
	["큰부리도요", "Limnodromus semipalmatus"],
	["큰지느러미발도요", "Phalaropus tricolor"],
	["학도요", "Tringa erythropus"],
	["흑꼬리도요", "Limosa limosa"],
	["흰꼬리좀도요", "Calidris temminckii"],
	["물꿩", "Hydrophasianus chirurgus"],
	["개꿩", "Pluvialis squatarola"],
	["검은가슴물떼새", "Pluvialis fulva"],
	["검은머리물떼새", "Haematopus ostralegus"],
	["꼬마물떼새", "Charadrius dubius"],
	["댕기물떼새", "Vanellus vanellus"],
	["뒷부리장다리물떼새", "Recurvirostra avosetta"],
	["민댕기물떼새", "Vanellus cinereus"],
	["왕눈물떼새", "Charadrius mongolus"],
	["장다리물떼새", "Himantopus himantopus"],
	["큰왕눈물떼새", "Charadrius leschenaultii"],
	["흰목물떼새", "Charadrius placidus"],
	["흰물떼새", "Charadrius alexandrinus"],
	["흰죽지꼬마물떼새", "Charadrius hiaticula"],
	["바다오리", "Uria aalge"],
	["바다쇠오리", "Synthliboramphus antiquus"],
	["뿔쇠오리", "Synthliboramphus wumizusume"],
	["알랑쇠오리", "Brachyramphus marmoratus"],
	["작은바다오리", "Aethia pusilla"],
	["흰눈썹바다오리", "Cepphus carbo"],
	["흰수염바다오리", "Cerorhinca monocerata"],
	["구레나룻제비갈매기", "Chlidonias hybridus"],
	["제비갈매기", "Sterna hirundo"],
	["큰부리제비갈매기", "Sterna nilotica"],
	["큰제비갈매기", "Sterna bergii"],
	["흰죽지갈매기", "Chlidonias leucopterus"],
	["제비물떼새", "Glareola maldivarum"],
	["호사도요", "Rostratula benghalensis"],
	["느시", "Otis tarda"],
	["검은목두루미", "Grus grus"],
	["두루미", "Grus japonensis"],
	["쇠재두루미", "Grus virgo"],
	["시베리아흰두루미", "Grus leucogeranus"],
	["재두루미", "Grus vipio"],
	["캐나다두루미", "Grus canadensis"],
	["흑두루미", "Grus monacha"],
	["뜸부기", "Gallicrex cinerea"],
	["물닭", "Fulica atra"],
	["쇠뜸부기", "Porzana pusilla"],
	["쇠뜸부기사촌", "Porzana fusca"],
	["쇠물닭", "Gallinula chloropus"],
	["알락뜸부기", "Coturnicops exquisitus"],
	["한국뜸부기", "Porzana paykullii"],
	["흰눈썹뜸부기", "Rallus aquaticus"],
	["흰배뜸부기", "Amaurornis phoenicurus"],
	["개미잡이", "Jynx torquilla"],
	["까막딱따구리", "Dryocopus martius"],
	["붉은배오색딱따구리", "Dendrocopos hyperythrus"],
	["세가락딱따구리", "Picoides tridactylus"],
	["쇠딱따구리", "Dendrocopos kizuki"],
	["쇠오색딱따구리", "Dendrocopos minor (1970년 최후 기록이)"],
	["아무르쇠딱따구리", "Dendrocopos canicapillus"],
	["오색딱따구리", "Dendrocopos major"],
	["청딱따구리", "Picus canus"],
	["크낙새", "Dryocopus javensis"],
	["큰오색딱따구리", "Dendrocopos leucotos"],
	["매", "Falco peregrinus"],
	["비둘기조롱이", "Falco vespertinus"],
	["새홀리기", "Falco subbuteo"],
	["쇠황조롱이", "Falco columbarius"],
	["헨다손매", "Falco cherrug"],
	["황조롱이", "Falco tinnunculus"],
	["녹색비둘기", "Treron sieboldii"],
	["멧비둘기", "Streptopelia orientalis"],
	["분홍가슴비둘기", "Columba oenas"],
	["염주비둘기", "Streptopelia decaocto"],
	["양비둘기", "Columba rupestris"],
	["홍비둘기", "Streptopelia tranquebarica"],
	["흑비둘기", "Columba janthina"],
	["검은등뻐꾸기", "Cuculus micropterus"],
	["두견이", "Cuculus poliocephalus"],
	["매사촌", "Cuculus fugax"],
	["벙어리뻐꾸기", "Cuculus saturatus"],
	["뻐꾸기", "Cuculus canorus"],
	["가마우지", "Phalacrocorax capillatus"],
	["민물가마우지", "Phalacrocorax carbo"],
	["붉은뺨가마우지", "Phalacrocorax urile"],
	["쇠가마우지", "Phalacrocorax pelagicus"],
	["군함조", "Fregata ariel"],
	["큰군함조", "Fregata minor"],
	["사다새", "Pelecanus philippensis"],
	["갈색얼가니새", "Sula leucogaster"],
	["푸른얼굴얼가니새", "Sula dactylatra"],
	["세가락메추라기", "Turnix tanki"],
	["바다제비", "Oceanodroma monorhis"],
	["붉은발슴새", "Puffinus carneipes"],
	["쇠부리슴새", "Puffinus tenuirostris"],
	["슴새", "Calonectris leucomelas"],
	["흰배슴새", "Pterodroma hypoleuca"],
	["신천옹", "Diomedea albatrus (1891년 최후 기록이)"],
	["아비", "Gavia stellata"],
	["큰회색머리아비", "Gavia arctica"],
	["회색머리아비", "Gavia pacifica"],
	["흰부리아비", "Gavia adamsii"],
	["쏙독새", "Caprimulgus indicus"],
	["금눈쇠올빼미", "Athene noctua"],
	["긴꼬리올빼미", "Surnia ulula (1967년 최후 기록이)"],
	["긴점박이올빼미", "Strix uralensis"],
	["소쩍새", "Otus scops"],
	["솔부엉이", "Ninox scutulata"],
	["쇠부엉이", "Asio flammeus"],
	["수리부엉이", "Bubo bubo"],
	["올빼미", "Strix aluco"],
	["칡부엉이", "Asio otus"],
	["큰소쩍새", "Otus bakkamoena"],
	["흰올빼미", "Nyctea scandiaca (1912년 최후 기록이)"],
	["개개비", "Acrocephalus orientalis"],
	["쇠개개비", "Acrocephalus bistrigiceps"],
	["큰부리개개비", "Acrocephalus aedon"],
	["개개비사촌", "Cisticola juncidis"],
	["꼬리치레", "Rhopophilus pekinensis"],
	["개똥지빠귀", "Turdus naumanni eunomus (ssp. in Japan)"],
	["검은지빠귀", "Turdus cardis"],
	["노랑지빠귀", "Turdus naumanni naumanni"],
	["대륙검은지빠귀", "Turdus merula"],
	["되지빠귀", "Turdus hortulorum"],
	["붉은목지빠귀", "Turdus ruficollis"],
	["붉은배지빠귀", "Turdus chrysolaus"],
	["흰눈썹붉은배지빠귀", "Turdus obscurus"],
	["흰눈썹지빠귀", "Zoothera sibirica"],
	["흰배지빠귀", "Turdus pallidus"],
	["굴뚝새", "Troglodytes troglodytes"],
	["갈까마귀", "Corvus dauuricus"],
	["까마귀", "Corvus corone"],
	["까치", "Pica pica"],
	["떼까마귀", "Corvus frugilegus"],
	["물까치", "Cyanopica cyana"],
	["붉은부리까마귀", "Pyrrhocorax pyrrhocorax"],
	["어치", "Garrulus glandarius"],
	["잣까마귀", "Nucifraga caryocatactes"],
	["큰부리까마귀", "Corvus macrorhynchos"],
	["북방긴꼬리딱새(별삼광조)", "Terpsiphone paradisi"],
	["긴꼬리딱새(삼광조)", "Terpsiphone atrocaudata"],
	["붉은머리오목눈이", "Paradoxornis webbianus"],
	["꾀꼬리", "Oriolus chinensis"],
	["나무발발이", "Certhia familiaris"],
	["동고비", "Sitta europaea"],
	["쇠동고비", "Sitta villosa"],
	["동박새", "Zosterops japonicus"],
	["한국동박새", "Zosterops erythropleurus"],
	["갈색양진이", "Leucosticte arctoa"],
	["긴꼬리홍양진이", "Uragus sibiricus"],
	["되새", "Fringilla montifringilla"],
	["멋쟁이", "Pyrrhula pyrrhula"],
	["밀화부리", "Eophona migratoria"],
	["방울새", "Carduelis sinica"],
	["솔양진이", "Pinicola enucleator (1959년 최후 기록이)"],
	["솔잣새", "Loxia curvirostra"],
	["쇠홍방울새", "Carduelis hornemanni"],
	["양진이", "Carpodacus roseus"],
	["적원자", "Carpodacus erythrinus"],
	["콩새", "Coccothraustes coccothraustes"],
	["큰부리밀화부리", "Eophona personata"],
	["홍방울새", "Carduelis flammea"],
	["흰죽지솔잣새", "Loxia leucoptera (1969년 최후 기록이)"],
	["검은등사막딱새", "Oenanthe pleschanka"],
	["검은머리딱새", "Phoenicurus ochruros"],
	["검은뺨딱새", "Saxicola ferrea"],
	["꼬까직박구리", "Monticola gularis"],
	["노랑딱새", "Ficedula mugimaki"],
	["딱새", "Phoenicurus auroreus"],
	["바다직박구리", "Monticola solitarius"],
	["서양흰꼬리딱새", "Ficedula parva"],
	["솔딱새", "Muscicapa sibirica"],
	["쇠솔딱새", "Muscicapa dauurica"],
	["쇠유리새", "Luscinia cyane"],
	["울새", "Luscinia sibilans"],
	["유리딱새", "Tarsiger cyanurus"],
	["제비딱새", "Muscicapa griseisticta"],
	["진홍가슴", "Luscinia calliope"],
	["큰유리새", "Cyanoptila cyanomelana"],
	["황금새", "Ficedula narcissina"],
	["흰눈썹울새", "Luscinia svecica"],
	["흰눈썹황금새", "Ficedula zanthopygia"],
	["긴꼬리때까치", "Lanius schach"],
	["노랑때까치", "Lanius cristatus"],
	["때까치", "Lanius bucephalus"],
	["물때까치", "Lanius sphenocercus"],
	["칡때까치", "Lanius tigrinus"],
	["큰재개구마리", "Lanius excubitor"],
	["검은머리쑥새", "Emberiza schoeniclus"],
	["검은머리촉새", "Emberiza aureola"],
	["검은멧새", "Emberiza variabilis"],
	["긴발톱멧새", "Calcarius lapponicus"],
	["꼬까참새", "Emberiza rutila"],
	["노랑눈썹멧새", "Emberiza chrysophrys"],
	["노랑턱멧새", "Emberiza elegans"],
	["멧새", "Emberiza cioides"],
	["무당새", "Emberiza sulphurata"],
	["북방검은머리쑥새", "Emberiza pallasi"],
	["붉은머리멧새", "Emberiza bruniceps"],
	["붉은뺨멧새", "Emberiza fucata"],
	["쇠검은머리쑥새", "Emberiza yessoensis"],
	["쇠붉은뺨멧새", "Emberiza pusilla"],
	["쑥새", "Emberiza rustica"],
	["점박이멧새", "Emberiza jankowskii (1929년 최후 기록이)"],
	["촉새", "Emberiza spodocephala"],
	["흰머리멧새", "Emberiza leucocephala (leucocephalos?)"],
	["흰멧새", "Plectrophenax nivalis"],
	["흰배멧새", "Emberiza tristrami"],
	["물까마귀", "Cinclus pallasii"],
	["검은바람까마귀", "Dicrurus macrocercus"],
	["바람까마귀", "Dicrurus hottentottus"],
	["회색바람까마귀", "Dicrurus leucophaeus"],
	["멧종다리", "Prunella montanella"],
	["바위종다리", "Prunella collaris"],
	["곤줄박이", "Parus varius"],
	["박새", "Parus major"],
	["북방쇠박새", "Parus montanus"],
	["쇠박새", "Parus palustris"],
	["진박새", "Parus ater"],
	["상모솔새", "Regulus regulus"],
	["북방개개비", "Locustella certhiola"],
	["붉은허리개개비", "Locustella fasciolata"],
	["섬개개비", "Locustella pleskei"],
	["알락꼬리쥐발귀", "Locustella ochotensis"],
	["쥐발귀개개비", "Locustella lanceolata"],
	["큰개개비", "Magalurus pryeri (1962년 최후 기록이)"],
	["긴다리솔새사촌", "Phylloscopus schwarzi"],
	["노랑허리솔새", "Phylloscopus proregulus"],
	["노랑눈썹솔새", "Phylloscopus inornatus"],
	["되솔새", "Phylloscopus tenellipes"],
	["산솔새", "Phylloscopus occipitalis"],
	["솔새사촌", "Phylloscopus fuscatus"],
	["쇠솔새", "Phylloscopus borealis"],
	["홍여새", "Bombycilla japonica"],
	["황여새", "Bombycilla garrulus"],
	["오목눈이", "Aegithalos caudatus"],
	["갈색제비", "Riparia riparia"],
	["귀제비", "Hirundo daurica"],
	["제비", "Hirundo rustica"],
	["흰턱제비", "Delichon urbica"],
	["흰털발제비", "Delichon urbicum"],
	["뿔종다리", "Galerida cristata"],
	["종다리", "Alauda arvensis"],
	["직박구리", "Ixos amaurotis"],
	["북방쇠찌르레기", "Sturnus sturninus"],
	["쇠찌르레기", "Sturnus philippensis"],
	["잿빛쇠찌르레기", "Sturnus sinensis"],
	["찌르레기", "Sturnus cineraceus"],
	["흰점찌르레기", "Sturnus vulgaris"],
	["참새", "Passer montanus"],
	["섬참새", "Passer rutilans"],
	["팔색조", "Pitta nympha"],
	["검은할미새사촌", "Coracina melaschistos"],
	["할미새사촌", "Pericrocotus divaricatus"],
	["검은등할미새", "Motacilla grandis"],
	["노랑할미새", "Motacilla cinerea"],
	["물레새", "Dendronanthus indicus"],
	["붉은가슴밭종다리", "Anthus cervinus"],
	["쇠밭종다리", "Anthus godlewskii"],
	["알락할미새", "Motacilla alba"],
	["옅은밭종다리", "Anthus spinoletta"],
	["큰밭종다리", "Anthus richardi"],
	["한국밭종다리", "Anthus roseatus"],
	["흰등밭종다리", "Anthus gustavi"],
	["힝둥새", "Anthus hodgsoni"],
	["섬휘파람새", "Cettia diphone"],
	["숲새", "Urosphena squameiceps"],
	["쇠흰턱딱새", "Sylvia curruca"],
	["바늘꼬리칼새", "Hirundapus caudacutus"],
	["칼새", "Apus pacificus"],
	["물총새", "Alcedo atthis"],
	["뿔호반새", "Ceryle lugubris (Megaceryle?) (1949년 최후 기록이)"],
	["파랑새", "Eurystomus orientalis"],
	["청호반새", "Halcyon pileata"],
	["호반새", "Halcyon coromanda"],
	["후투티", "Upupa epops"],
	["검은댕기해오라기", "Butorides striatus"],
	["노랑부리백로", "Egretta eulophotes"],
	["대백로", "Egretta alba"],
	["덤불해오라기", "Ixobrychus sinensis"],
	["붉은왜가리", "Ardea purpurea"],
	["붉은해오라기", "Gorsachius goisagi"],
	["쇠백로", "Egretta garzetta"],
	["알락해오라기", "Botaurus stellaris"],
	["열대붉은해오라기", "Ixobrychus cinnamomeus"],
	["왜가리", "Ardea cinerea"],
	["중백로", "Egretta intermedia"],
	["큰덤불해오라기", "Ixobrychus eurhythmus"],
	["해오라기", "Nycticorax nycticorax"],
	["황로", "Bubulcus ibis"],
	["흑로", "Egretta sacra"],
	["흰날개해오라기", "Ardeola bacchus"],
	["검은머리흰따오기", "Threskiornis melanocephalus"],
	["노랑부리저어새", "Platalea leucorodia"],
	["따오기", "Nipponia nippon (1979년 최후 기록이)"],
	["저어새", "Platalea minor"],
	["먹황새", "Ciconia nigra"],
	["황새", "Ciconia boyciana"],
	["개구리매", "Circus aeruginosus"],
	["검독수리", "Aquila chrysaetos"],
	["관수리", "Spilornis cheela"],
	["독수리", "Aegypius monachus"],
	["말똥가리", "Buteo buteo"],
	["물수리", "Pandion haliaetus"],
	["붉은배새매", "Accipiter soloensis"],
	["뿔매", "Spizaetus nipalensis (1934년 최후 기록이)"],
	["새매", "Accipiter nisus"],
	["솔개", "Milvus lineatus"],
	["수염수리", "Gypaetus barbatus (1918년 최후 기록이)"],
	["알락개구리매", "Circus melanoleucus (melanoleucos?)"],
	["왕새매", "Butastur indicus"],
	["잿빛개구리매", "Circus cyaneus"],
	["조롱이", "Accipiter gularis"],
	["참매", "Accipiter gentilis"],
	["참수리", "Haliaeetus pelagicus"],
	["큰말똥가리", "Buteo hemilasius"],
	["털발말똥가리", "Buteo lagopus"],
	["항라머리검독수리", "Aquila clanga"],
	["흰꼬리수리", "Haliaeetus albicilla"],
	["흰죽지수리", "Aquila heliaca"],
];
    var box_list = [];
    function get_random_name() {
        var idx =  Math.floor(Math.random() * BIRDNAME_LIST.length);
        return BIRDNAME_LIST[idx][0];          
    }
    function add_form(a_box){
        //e.preventDefault();
        var emptyForm = document.getElementById("empty-form")
        var newForm = emptyForm.cloneNode(true);
        newForm.style.display="block";
        var specimenForm = document.querySelectorAll(".dolfinbox-form")        

        var formNum = specimenForm.length-1
        formNum++;

        newForm.innerHTML = newForm.innerHTML.replace(/__prefix__/g, formNum);
        var container = document.getElementById("dolfinbox-form-container")
        var newRow = container.insertRow();
        newRow.classList.add("text-center");
        newRow.classList.add("dolfinbox-form");
        newRow.innerHTML = newForm.innerHTML;
        var totalForms = document.getElementById("id_finboxes-TOTAL_FORMS")
        totalForms.setAttribute('value', `${formNum+1}`)

        coord_input = document.getElementById("id_finboxes-"+String(formNum)+"-coords_str");
        coord_input.value = String(a_box);
        name_input = document.getElementById("id_finboxes-"+String(formNum)+"-boxname");
        name_input.value = get_random_name();
    }

    function add_finbox( a_box ) {
        [ x1, y1, x2, y2 ] = a_box;
        if(x2 < 0 || x1 > widthImage || x1==x2 || y2 < 0 || y1 > heightImage || y2==y1 ){return;}
        //console.log(a_box);
        //console.log(box_list);
        box_list[box_list.length] = a_box;

        //console.log(box_list);
        //fin_list_div = document.getElementById("fin_list");
        //new_fin_div = document.createElement("div");
        //new_fin_div.innerHTML = String(a_box);
        //fin_list_div.appendChild(new_fin_div);
        add_form(a_box);
    }

    var LEFT_BUTTON = 0;
    var RIGHT_BUTTON = 2;
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");

    var widthCanvas;
    var heightCanvas;

        // View parameters
    var xleftView = 0;
    var ytopView = 0;
    var widthViewOriginal = 1.0;           //actual width and height of zoomed and panned display
    var heightViewOriginal = 1.0;
    var widthView = widthViewOriginal;           //actual width and height of zoomed and panned display
    var heightView = heightViewOriginal;
    var widthImage = 0;
    var heightImage = 0;
    var image_canvas_ratio = 0;
    var editable = false;
    
    var img = new Image();
    img.src= "{{image.imagefile.url}}";
    img.onload=function(){
        widthCanvas = canvas.width;
        heightCanvas = canvas.height;
        whratioCanvas = widthCanvas / heightCanvas;
        widthImage = img.width;
        heightImage = img.height;
        whratioImage = widthImage / heightImage;
        if( whratioCanvas > whratioImage ) {
            image_canvas_ratio = heightImage / heightCanvas;
        } else {
            image_canvas_ratio = widthImage / widthCanvas;
        }
        //console.log("canvas:", widthCanvas, heightCanvas, "image:", widthImage, heightImage);
        //image_canvas_ratio = widthImage/widthCanvas;
        draw();

        //canvas.addEventListener("dblclick", handleDblClick, false);  // dblclick to zoom in at point, shift dblclick to zoom out.
        if( editable == true ) {
            canvas.addEventListener("mousedown", handleMouseDown, false); // click and hold to pan
            canvas.addEventListener("mousemove", handleMouseMove, false);
            canvas.addEventListener("mouseup", handleMouseUp, false);
            canvas.addEventListener("mouseout", handleMouseOut, false);
            canvas.addEventListener("mousewheel", handleMouseWheel, false); // mousewheel duplicates dblclick function
            canvas.addEventListener('contextmenu', (event) => {event.preventDefault();});
            canvas.addEventListener("DOMMouseScroll", handleMouseWheel, false); // for Firefox
        }
    }
    function scale_to_canvas( coord ) { return Math.round(( coord / image_canvas_ratio ) * scale); }
    function scale_to_image( coord ) { return Math.round(( coord / scale ) * image_canvas_ratio); }
    function draw() {
        context.fillStyle = "grey";
        context.fillRect(0,0, widthCanvas,heightCanvas);
        context.drawImage(img,lastupX+deltaX,lastupY+deltaY,(widthImage/image_canvas_ratio)*scale,(heightImage/image_canvas_ratio)*scale);
        for( var i=0;i<box_list.length;i++){
            box = box_list[i];
            context.beginPath();
            //context.rect( (box[0]/image_canvas_ratio)*scale+lastupX+deltaX, (box[1]/image_canvas_ratio)*scale+lastupY+deltaY, ((box[2]-box[0])/image_canvas_ratio)*scale, ((box[3]-box[1])/image_canvas_ratio)*scale);
            context.rect( scale_to_canvas(box[0])+lastupX+deltaX, scale_to_canvas(box[1])+lastupY+deltaY, scale_to_canvas(box[2]-box[0]), scale_to_canvas(box[3]-box[1]));
            context.stroke();            
        }
        if( drawing_box ) {
            context.beginPath();
            [ draw_x1, draw_y1, draw_x2, draw_y2 ] = [ box_x1, box_y1, box_x2, box_y2 ];
            if( box_x1 > box_x2 ) { [draw_x1, draw_x2] = [box_x2,box_x1];}
            if( box_y1 > box_y2 ) { [draw_y1, draw_y2] = [box_y2,box_y1];}
            context.rect( draw_x1, draw_y1, draw_x2 - draw_x1, draw_y2 - draw_y1 );
            context.stroke();            
        }
    }
    
    var panning = false;
    var drawing_box = false;
    var downX = 0;
    var downY = 0;
    var box_x1 = -1, box_y1 = -1, box_x2 = -1, box_y2 = -1;

    function handleMouseDown(event) {
        //console.log("button:", event.button);
        if(event.button == RIGHT_BUTTON) {
            panning = true;
            //downX = event.clientX - this.offsetLeft - this.clientLeft + this.scrollLeft;
            //downY = event.clientY - this.offsetTop - this.clientTop + this.scrollTop;
            let box = this.getBoundingClientRect();
            downX = Math.round(event.clientX-box.left);
            downY = Math.round(event.clientY-box.top);
            //console.log("down:",downX,downY);
        } else if( event.button == LEFT_BUTTON ) {
            let box = this.getBoundingClientRect();
            box_x1 = Math.round(event.clientX-box.left);
            box_y1 = Math.round(event.clientY-box.top);
            drawing_box = true
        }
    }

    var lastupX = 0;
    var lastupY = 0;
    var deltaX = 0;
    var deltaY = 0;
    var scale=1;

    function handleMouseOut(event) {
        //if(event.button == 2) { console.log("right button"); event.preventDefault(); }
        //console.log("mouse up")
        if(panning) {
            lastupX += deltaX;
            lastupY += deltaY;
            deltaX = 0;
            deltaY = 0;
            panning=false;
        } 
        draw()
    }


    function handleMouseUp(event) {
        //if(event.button == 2) { console.log("right button"); event.preventDefault(); }
        //console.log("mouse up")
        if(event.button == RIGHT_BUTTON) {
            panning = false;
            lastupX += deltaX;
            lastupY += deltaY;
            deltaX = 0;
            deltaY = 0;
        } else if( event.button == LEFT_BUTTON ){
            /* add box */
            drawing_box = false;
            let box = this.getBoundingClientRect();
            box_x2 = Math.round(event.clientX-box.left);
            box_y2 = Math.round(event.clientY-box.top);
            if(box_x1>box_x2){[box_x1,box_x2]=[box_x2,box_x1];}
            if(box_y1>box_y2){[box_y1,box_y2]=[box_y2,box_y1];}
            //console.log( box_x1, box_y1, box_x2, box_y2 );
            real_x1 = Math.max(scale_to_image(box_x1 - lastupX),0);
            real_x2 = Math.min(scale_to_image(box_x2 - lastupX),widthImage);
            real_y1 = Math.max(scale_to_image(box_y1 - lastupY),0);
            real_y2 = Math.min(scale_to_image(box_y2 - lastupY),heightImage);
            //console.log( real_x1, real_y1, real_x2, real_y2 );
            add_finbox([real_x1, real_y1, real_x2, real_y2]);
            //
            [box_x1,box_y1,box_x2,box_y2] = [-1,-1,-1,-1];
        }
    }

    
    function handleMouseMove(event) {
        //var X = event.clientX - this.offsetLeft - this.clientLeft + this.scrollLeft;
        //var Y = event.clientY - this.offsetTop - this.clientTop + this.scrollTop;
        let box = this.getBoundingClientRect();
        var X = Math.round(event.clientX-box.left);
        var Y = Math.round(event.clientY-box.top);

        //console.log(X,event.clientX,box.left,box.top,this.offsetLeft,this.clientLeft,this.scrollLeft,Y,event.clientY,this.offsetTop,this.clientTop,this.scrollTop,lastupX,lastupY);
        //console.log(event.clientX,box.left,event.clientY,box.top,Math.round(event.clientX-box.left),Math.round(event.clientY-box.top));
        if (panning) {
            deltaX = X - downX;
            deltaY = Y - downY;
            //console.log(deltaX,deltaY);
        } else if ( drawing_box ) {
            box_x2 = X;
            box_y2 = Y;
        }
        lastX = X;
        lastY = Y;
        //console.log(xleftView,ytopView)
        draw();
    }
    function handleMouseWheel(event) {
        //event.stopPropagation();
        //console.log("wheel");

        event.preventDefault();
        var scaleDelta = (event.wheelDelta < 0 || event.detail > 0) ? -0.1 : +0.1;
        if( scale <= 0.8 && scaleDelta < 0 ) {
            //lastupX = 0; lastupY = 0;
            return;
        }
        if( scale > 1 ) scaleDelta *= Math.floor(scale);
        prev_scale = scale;
        scale += scaleDelta;
        scale = Math.round( scale * 10 ) / 10;
        scale_proportion = scale/prev_scale;
        //var X = event.clientX - this.offsetLeft - this.clientLeft + this.scrollLeft;
        //var Y = event.clientY - this.offsetTop - this.clientTop + this.scrollTop;
        let box = this.getBoundingClientRect();

        var X = Math.round(event.clientX-box.left);
        var Y = Math.round(event.clientY-box.top);
        //console.log(X, Y, lastupX, lastupY, scale);
        lastupX = X - ( X - lastupX ) * scale_proportion;
        lastupY = Y - ( Y - lastupY ) * scale_proportion;
        //console.log(X, Y, lastupX, lastupY, scale);
        draw();
    }
